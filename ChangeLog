2003-11-09  Larry Ewing  <lewing@ximian.com>

	* configure.in: drop libgnome requirement to 2.2 since it doens't
	seem to break anything.

	* src/PixbufLoader.cs (PixbufLoader.processRequest): catch the
	possible Pixbuf exceptions.

	* src/PhotoView.cs (PhotoView.UpdateImageView): catch the possible Pixbuf exception.

	* src/IconView.cs (IconView.ErrorPixbuf): use the question mark icon we ship.

2003-11-10  Ettore Perazzoli  <ettore@ximian.com>

	* src/InfoBox.cs (InfoBox.Update): Get the size info from the
	photo's DefaultVersionPath instead of its Path.

2003-11-09  Ettore Perazzoli  <ettore@ximian.com>

	* src/MainWindow.cs (MainWindow.ctor): Pass false as the "shrink"
	arg in Paned.Pack1() for the left pane so we don't get sized below
	the InfoBox' size requisition.

2003-11-09  Ettore Perazzoli  <ettore@ximian.com>

	* src/MainWindow.cs (MainWindow.HandlePhotoViewButtonPressEvent):
	Button press event handler for the PhotoView, so we can switch to
	icon view mode on double click.
	(MainWindow.ctor): Connect.

	* libfspot/f-image-view.c (impl_button_press_event): Clean up on
	GDK_2BUTTON_PRESS.

2003-11-09  Ettore Perazzoli  <ettore@ximian.com>

	* src/ZoomUtils.cs: Import from libfspoteog, not libeog.

2003-11-09  Ettore Perazzoli  <ettore@ximian.com>

	* configure.in: Remove gnome-thumbnail.h check, add a Sqlite
	check.

2003-11-09  Ettore Perazzoli  <ettore@ximian.com>

	* src/PhotoVersionCommands.cs (PhotoVersionCommands.Create): Pass
	true for create_file to Photo.CreateVersion.

	* src/IconView.cs (IconView.Scroll): Use Photo.DefaultVersionPath
	instead of Photo.Path.
	(IconView.DrawCell): Likewise.
	(UpdateThumbnail): New method to have a thumbnail reloaded.

	* src/MainWindow.cs (MainWindow.ctor): Pass photo store to
	PhotoView.
	(MainWindow.HandleCreateVersionCommand): Update the thumbnail in
	the icon view.
	(MainWindow.HandleDeleteVersionCommand): Likewise.
	(MainWindow.HandleRenameVersionCommand): Likewise.
	(MainWindow.UpdateForVersionIdChange): Likewise.
	(MainWindow.HandlePhotoViewPhotoChanged): New handler for the
	PhotoChanged event on the PhotoView.
	(MainWindow.ctor): Connect.

	* src/PhotoView.cs (PhotoView.HandleCropButtonClicked): New.
	(PhotoView.ctor): Connect to the "Clicked" event on the crop
	button.
	(PhotoView.photo_store): New member to keep a pointer to the photo
	store.
	(PhotoView.ctor): Get a PhotoStore arg, initialize photo_store.
	(PhotoView.PhotoChanged): New public event.
	(PhotoView.UpdateImageView): Use Photo.DefaultVersionPath instead
	of .Path, so that we display the default version.
	(PhotoView.HandleDisplayNextButtonClicked): Emit PhotoChanged.
	(PhotoView.HandleDisplayPreviousButtonClicked): Emit PhotoChanged.

	* src/PhotoStore.cs (Photo.CreateDefaultModifiedVersion): New.
	(Photo.CreateVersion): Get a bool arg specifying whether to create
	a file for the new version or not.
	(Photo.DefaultVersionPath): New public property.

2003-11-09  Ettore Perazzoli  <ettore@ximian.com>

	* src/InfoBox.cs (InfoBox.SetupWidgets): Move the version option
	menu up, after the name entry; I think it makes more sense this
	way.

2003-11-09  Ettore Perazzoli  <ettore@ximian.com>

	* src/MainWindow.cs (MainWindow.UpdateForVersionIdChange): New.
	(MainWindow.HandleVersionIdChanged): Use it.
	(MainWindow.HandleInfoBoxVersionIdChanged): New.
	(MainWindow.ctor): Hook to the VersionIdChanged event on the
	InfoBox.

	* src/InfoBox.cs (InfoBox.VersionIdChanged): New public event.
	(InfoBox.HandleVersionIdChanged): Handler for the PhotoVersionMenu
	version id changes, emits VersionIdChanged.
	(InfoBox.Update): Make it use PhotoVersionMenu.
	(InfoBox.PopulateVersionOptionMenu): Remove.
	(InfoBox.HandleVersionOptionMenuActivated): Remove.

2003-11-09  Ettore Perazzoli  <ettore@ximian.com>

	* configure.in: Require Gnome 2.4 libs.

2003-11-09  Ettore Perazzoli  <ettore@ximian.com>

	* src/PhotoVersionCommands.cs
	(PhotoVersionCommands.VersionNameRequest): Change so that it gets
	a request type and sets prompt and title depending on it.  Also,
	don't give a "this name already exists" warning if it's a rename
	request and the user typed the same name as the current version
	and return ResponseType.Cancel in that case even if the user
	clicked "Ok".
	(PhotoVersionCommands.Create): Update accordingly.
	(PhotoVersionCommands.Rename): Update accordingly.
	(PhotoVersionCommands.Update): New.
	(PhotoVersionCommands.VersionNameRequest.HandleVersionNameEntryChanged):
	Use it.
	(PhotoVersionCommands.VersionNameRequest.Run): Likewise.

2003-11-09  Ettore Perazzoli  <ettore@ximian.com>

	* src/PhotoVersionCommands.cs
	(PhotoVersionCommands.Delete.Execute): Implement.
	(PhotoVersionCommands.VersionNameRequest): New private class for
	generic version name requests.
	(PhotoVersionCommands.Create): Use this class.
	(PhotoVersionCommands.Rename): Implement.

	* src/f-spot.glade: Rename "create_new_version_dialog" to
	"version_name_dialog", give a name to the prompt label, remove all
	text.

	* src/MainWindow.cs (MainWindow.HandleVersionIdChanged): Call
	UpdateMenus().
	(MainWindow.HandleRenameVersionCommand): Implement.
	(MainWindow.UpdateMenus): Make the "rename version" menu item
	insensitive when the original version is selected.

	* src/PhotoStore.cs (Photo.GetVersionPath): Use GetVersionName().
	(Photo.DeleteVersion): Delete the version file.  Also, if we are
	deleting the DefaultVersion, re-set it to be the most recent of
	the versions before this one.
	(Photo.RenameVersion): Get a uint version_id, not an int, also use
	the proper name.

2003-11-09  Ettore Perazzoli  <ettore@ximian.com>

	* src/makefile.am: Include f-spot.glade as a resource into
	f-spot.exe.

	* src/f-spot.glade: New file, right now containing only the
	"Create New Version" dialog box.

	* src/ThumbnailCache.cs (ThumbnailCache.MaybeExpunge): Renamed
	from "maybeExpunge" for consistency.

	* src/PhotoView.cs (PhotoView.Update): Made public.

	* src/PhotoVersionMenu.cs: New file implementing a menu to select
	photo versions.

	* src/PhotoVersionCommands.cs: New file implementing version
	management commands.

	* src/PhotoStore.cs (Photo.default_version_id): New private member
	variable.
	(Photo.DefaultVersionId): New property.
	(Photo.VersionNameExists): Made public.
	(Photo.GetVersionPath): Return the appropriate path for the
	OriginalVersionId.
	(Photo.CreateVersion): Make a copy of the base version and
	generate a thumbnail for it.  Make sure that a file with the new
	path doesn't already exist.
	(PhotoStore.thumbnail_factory): Made static.
	(PhotoStore.EnsureThumbnailDirectory): Made static.
	(PhotoStore.GenerateThumbnail): New static method.
	(PhotoStore.Create): Use it.
	(PhotoStore.ctor): Add a default_version_id column to the table.
	(PhotoStore.Create): Set the default_version_id column.
	(PhotoStore.Get): Get the default_version_id column and set
	DefaultVersionId.
	(PhotoStore.Commit): Set the default_version_id column.  Also,
	don't store the OriginalVersionId in the photo_versions table.

	* src/MainWindow.cs: Added a Photo -> Version submenu and
	Create/Delete/Rename Version menu items.
	(MainWindow.CurrentPhoto): New private property to track the
	selected photo.

	* src/InfoBox.cs (InfoBox.Update): Made public.

2003-11-09  Ettore Perazzoli  <ettore@ximian.com>

	* configure.in: Don't require libxml.

2003-11-08  Ettore Perazzoli  <ettore@ximian.com>

	* src/ImportCommand.cs (ImportCommand.HandleDialogResponse):
	Renamed from "OnResponse" for consistency.

2003-11-08  Ettore Perazzoli  <ettore@ximian.com>

	* src/TagStore.cs (Tag.Children): Change from an ArrayList to an
	array.

	* src/TagSelectionWidget.cs (TagSelection): Return an array of
	tags instead of an ArrayList.

	* src/PhotoView.cs: Renamed private member "model" to "query";
	updated for the changes in PhotoQuery.
	(PhotoQuery.Query): Renamed from "Model".

	* src/PhotoStore.cs (Photo.Tags): Change from an ArrayList to an
	array.
	(Photo.Query): Return an array of Photos instead of an ArrayList.

	* src/MainWindow.cs (MainWindow.HandleSelectionChanged): Update
	for the fact that IconView.Selection is now an array.

	* src/InfoBox.cs (InfoBox.PhotoPath): Removed, together with the
	private "photo_path" member.
	(InfoBox.Photo): New property, use this instead.
	(InfoBox.HandleVersionOptionMenuActivated): New.
	(InfoBox.PopulateVersionOptionMenu): New.
	(InfoBox.Update): Call it.
	(InfoBox.SetupWidgets): Add a row with the version option menu.
	(InfoBox.Clear): Make the option menu insensitive.

	* src/IconView.cs (IconView): Rename local member "model" to
	"query"; make it use just a PhotoQuery object.
	(IconView.Selection): Return an array instead of an ArrayList.

	* src/PhotoQuery.cs: Don't derive from PhotoListModel anymore;
	move all the method inherited from PhotoListModel in.
	(PhotoQuery.Tags): Changed from an ArrayList to an array.
	(PhotoQuery.Photos): Return an array.
	(PhotoQuery.GetItem): Removed.

	* src/PhotoListModel.cs: Removed.

	* src/Db.cs (DbStore.AddToCache): Remove an existing item with the
	same ID as the one we are adding.

2003-11-08  Ettore Perazzoli  <ettore@ximian.com>

	* src/PhotoView.cs (PhotoView.UpdateImageView): Handle a null
	model or an out of range photo index value gracefully.

	* src/PhotoStore.cs (Photo.ctr): Moved initialization for "tags"
	out of the constructor.  Added version management.
	(Photo.VersionIds): New.
	(Photo.AddVersionUnsafely): New.
	(Photo.GetPathForVersionName): New.
	(Photo.VersionNameExists): New.
	(Photo.GetVersionName): New.
	(Photo.GetVersionPath): New.
	(Photo.DeleteVersion): New.
	(Photo.CreateVersion): New.
	(Photo.RenameVersion): New.
	(Photo.Photo): Made the two constructors use each other to
	avoid duplicated code.  Also, create the default "Original" version.
	(PhotoStore.ctor): Create the "photo_versions" table.
	(PhotoStore.Get): Get the versions from the database.
	(PhotoStore.Remove): Update the "photo_versions" table.
	(PhotoStore.Commit): Likewise.
	(Main): Added testing code for the versioning stuff.

	* src/ImageView.cs (ImageView.Pixbuf): Handle a null value.

2003-11-08  Ettore Perazzoli  <ettore@ximian.com>

	* MAINTAINERS: New.
	* Makefile.am (EXTRA_DIST): Add.

2003-11-08  Ettore Perazzoli  <ettore@ximian.com>

	* configure.in: Don't use gettext for now, we have no support for
	it anyhow.

